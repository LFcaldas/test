<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>🧠Haru's Flashcards</title>
    <meta name="description" content="Medical flashcards with AI for study" />
    <meta name="theme-color" content="#3498db" />

    <!-- PWA Manifest -->
    <link
        rel="manifest"
        href="data:application/json;base64,eyJuYW1lIjoiTWVkaWNhbCBGbGFzaGNhcmRzIEFJIiwic2hvcnRfbmFtZSI6Ik1lZEZsYXNoIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmMGY4ZmYiLCJ0aGVtZV9jb2xvciI6IiMzNDk4ZGIiLCJpY29ucyI6W119"
    />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #9b59b6, #e74c3c);
            border-radius: 20px 20px 0 0;
        }

        .category-badge {
            display: inline-block;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .question {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.5;
            color: #2c3e50;
        }

        .choices {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .choice {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .choice:hover {
            background: #e3f2fd;
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
        }

        .choice.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .choice.correct {
            background: #27ae60;
            color: white;
            border-color: #229954;
        }

        .choice.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .feedback {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.correct {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }

        .feedback.incorrect {
            border-left-color: #e74c3c;
            background: #fdeaea;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
            min-width: 120px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(52, 152, 219, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .stats-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active,
        .difficulty-btn:hover {
            background: #3498db;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .install-banner {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px;
            text-align: center;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .install-banner.show {
            transform: translateY(0);
        }

        .achievements {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .achievement {
            background: #f39c12;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .card {
                padding: 20px;
                margin: 10px 0;
            }

            .question {
                font-size: 1.2rem;
            }

            .choice {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- at the very top of your <body> -->
<div id="openExternally" style="display:none; background:#fff9c4; padding:10px; text-align:center; font-size:0.9rem; border-bottom:1px solid #ddd;">
    This page works best in a regular browser. 
    <a href="javascript:void(0)" id="openLink" style="color:#007aff; text-decoration:none;">Tap here to open in Chrome/Edge</a>
  </div>
  <script>
    // detect WeChat’s webview (userAgent contains “MicroMessenger”)
    const ua = navigator.userAgent || '';
    if (ua.includes('MicroMessenger')) {
      document.getElementById('openExternally').style.display = 'block';
      document.getElementById('openLink').addEventListener('click', () => {
        // On Android, try an Intent URL for Chrome
        const url = location.href;
        // “intent:” scheme only works if Chrome is installed
        window.location.href = `intent://${url.replace(/^https?:\/\//, '')}#Intent;package=com.android.chrome;scheme=https;end`;
        // If that fails (iOS or Chrome not installed), fallback to just reloading:
        setTimeout(() => location.href = url, 500);
      });
    }
  </script>  
    <div class="container">
        <div class="header">
            <h1>🧠Haru's Flashcards</h1>
            <div class="progress-info">
                <span id="cardCounter">Card 1/10</span>
                <span id="scoreDisplay">Score: 0/0</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">Easy</button>
            <button class="difficulty-btn" data-difficulty="medium">Medium</button>
            <button class="difficulty-btn" data-difficulty="hard">Hard</button>
            <button class="difficulty-btn" data-difficulty="mixed">Mixed</button>
        </div>

        <div class="card" id="flashcard">
            <div class="category-badge" id="categoryBadge">Neuroanatomy</div>
            <div class="question" id="questionText">
                Loading question...
            </div>
            <div class="choices" id="choicesContainer">
                <!-- Choices will be populated by JavaScript -->
            </div>
            <div class="feedback" id="feedback">
                <!-- Feedback will be shown here -->
            </div>
            <div class="controls">
                <button class="btn" id="checkBtn">Check Answer</button>
                <button class="btn secondary" id="nextBtn" disabled>Next</button>
                <button class="btn secondary" id="hintBtn">💡 Hint</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn secondary" id="statsBtn">📊 Statistics</button>
            <button class="btn secondary" id="restartBtn">🔄 Restart</button>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="stats-modal" id="statsModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h2>📊 Your Statistics</h2>
            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be populated here -->
            </div>
            <div class="achievements" id="achievements">
                <!-- Achievements will be shown here -->
            </div>
            <div id="weakAreas">
                <!-- Weak areas analysis -->
            </div>
        </div>
    </div>

    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
        <p>📱 Install this app on your phone for offline access!</p>
        <button class="btn" id="installBtn" style="margin: 10px;">Install</button>
        <button class="btn secondary" id="dismissBtn">Dismiss</button>
    </div>

    <script>
        // Medical Flashcards Database - All questions focused on Neurology
        const flashcardsDatabase = {
            easy: [
                {
                    question: "Which lobe of the brain is primarily responsible for processing visual information?",
                    choices: ["Occipital lobe", "Frontal lobe", "Temporal lobe", "Parietal lobe"],
                    answer: "Occipital lobe",
                    category: "Neuroanatomy",
                    explanation: "The occipital lobe is the main center for visual processing in the brain."
                },
                {
                    question: "What is the basic functional unit of the nervous system?",
                    choices: ["Neuron", "Glial cell", "Axon", "Synapse"],
                    answer: "Neuron",
                    category: "Neurobiology",
                    explanation: "Neurons are specialized cells that transmit electrical and chemical signals throughout the nervous system."
                },
                {
                    question: "Which part of a neuron receives incoming signals?",
                    choices: ["Dendrite", "Axon", "Cell body", "Myelin sheath"],
                    answer: "Dendrite",
                    category: "Neurobiology",
                    explanation: "Dendrites branch out from the cell body and receive synaptic inputs from other neurons."
                },
                {
                    question: "What is the gap between two neurons called?",
                    choices: ["Synapse", "Axon hillock", "Dendritic spine", "Node of Ranvier"],
                    answer: "Synapse",
                    category: "Neurophysiology",
                    explanation: "A synapse is the junction where neurotransmitters are released to transmit signals between neurons."
                },
                {
                    question: "Which cranial nerve is responsible for the sense of smell?",
                    choices: ["Olfactory nerve (I)", "Optic nerve (II)", "Trigeminal nerve (V)", "Facial nerve (VII)"],
                    answer: "Olfactory nerve (I)",
                    category: "Cranial Nerves",
                    explanation: "The olfactory nerve (cranial nerve I) carries sensory information related to smell from the nasal cavity to the brain."
                },
                {
                    question: "Which structure connects the two cerebral hemispheres?",
                    choices: ["Corpus callosum", "Fornix", "Anterior commissure", "Internal capsule"],
                    answer: "Corpus callosum",
                    category: "Neuroanatomy",
                    explanation: "The corpus callosum is a large white-matter tract that connects the left and right cerebral hemispheres."
                },
                {
                    question: "What type of neuron carries signals away from the central nervous system?",
                    choices: ["Motor neuron", "Sensory neuron", "Interneuron", "Pyramidal neuron"],
                    answer: "Motor neuron",
                    category: "Neurophysiology",
                    explanation: "Motor neurons transmit impulses from the CNS to effector organs like muscles and glands."
                }
            ],
            medium: [
                {
                    question: "Which neurotransmitter is primarily inhibitory in the central nervous system?",
                    choices: ["GABA", "Glutamate", "Acetylcholine", "Dopamine"],
                    answer: "GABA",
                    category: "Neurochemistry",
                    explanation: "GABA (gamma-aminobutyric acid) is the main inhibitory neurotransmitter in the CNS."
                },
                {
                    question: "Where is Broca's area located?",
                    choices: ["Frontal lobe (left hemisphere)", "Temporal lobe (left hemisphere)", "Parietal lobe", "Occipital lobe"],
                    answer: "Frontal lobe (left hemisphere)",
                    category: "Neuroanatomy",
                    explanation: "Broca's area, involved in speech production, is located in the posterior part of the inferior frontal gyrus of the dominant hemisphere (usually left)."
                },
                {
                    question: "Which tract carries pain and temperature sensations from the body to the brain?",
                    choices: ["Spinothalamic tract", "Dorsal columns", "Corticospinal tract", "Rubrospinal tract"],
                    answer: "Spinothalamic tract",
                    category: "Neuroanatomy",
                    explanation: "The spinothalamic tract transmits pain and temperature information from the spinal cord to the thalamus."
                },
                {
                    question: "Which midbrain nucleus is critically involved in reward processing and motor control?",
                    choices: ["Substantia nigra", "Red nucleus", "Locus coeruleus", "Raphe nucleus"],
                    answer: "Substantia nigra",
                    category: "Neuroanatomy",
                    explanation: "The substantia nigra is part of the basal ganglia circuitry and is essential for dopamine production, affecting reward and motor function."
                },
                {
                    question: "Which cerebral artery supplies most of the lateral surface of the cerebral hemispheres?",
                    choices: ["Middle cerebral artery", "Anterior cerebral artery", "Posterior cerebral artery", "Basilar artery"],
                    answer: "Middle cerebral artery",
                    category: "Neurovascular",
                    explanation: "The middle cerebral artery (MCA) provides blood to the lateral aspects of the frontal, parietal, and temporal lobes."
                },
                {
                    question: "What structure forms the blood-brain barrier along capillaries in the CNS?",
                    choices: ["Astrocytes", "Microglia", "Oligodendrocytes", "Ependymal cells"],
                    answer: "Astrocytes",
                    category: "Neurobiology",
                    explanation: "Astrocyte end-feet envelop blood vessels in the CNS and help maintain the blood-brain barrier."
                },
                {
                    question: "Which nerve roots make up the brachial plexus?",
                    choices: ["C5–T1", "L1–L5", "T12–L4", "S1–S4"],
                    answer: "C5–T1",
                    category: "Neuroanatomy",
                    explanation: "The brachial plexus arises from spinal nerve roots C5 through T1 and innervates the upper limb."
                }
            ],
            hard: [
                {
                    question: "What is the primary pathological finding in amyotrophic lateral sclerosis (ALS)?",
                    choices: [
                        "Degeneration of upper and lower motor neurons",
                        "Demyelination of peripheral nerves",
                        "Neurofibrillary tangles in hippocampus",
                        "Autoimmune attack on neuromuscular junction"
                    ],
                    answer: "Degeneration of upper and lower motor neurons",
                    category: "Neuropathology",
                    explanation: "ALS is characterized by progressive degeneration of both upper motor neurons in the cortex and lower motor neurons in the brainstem and spinal cord."
                },
                {
                    question: "Which glial cells produce myelin in the central nervous system?",
                    choices: ["Oligodendrocytes", "Schwann cells", "Astrocytes", "Microglia"],
                    answer: "Oligodendrocytes",
                    category: "Neurobiology",
                    explanation: "Oligodendrocytes extend multiple processes to form myelin sheaths around CNS axons. Schwann cells produce myelin in the PNS."
                },
                {
                    question: "Which structure connects the hippocampus to the mammillary bodies?",
                    choices: ["Fornix", "Cingulum", "Internal capsule", "Anterior commissure"],
                    answer: "Fornix",
                    category: "Neuroanatomy",
                    explanation: "The fornix is a C-shaped white-matter tract that connects the hippocampus to the mammillary bodies and septal nuclei."
                },
                {
                    question: "In multiple sclerosis, which immune cells predominantly attack the myelin sheath?",
                    choices: ["T lymphocytes", "B lymphocytes", "Microglia", "Macrophages"],
                    answer: "T lymphocytes",
                    category: "Neuroimmunology",
                    explanation: "In MS, autoreactive T lymphocytes cross the blood-brain barrier and initiate demyelination by attacking CNS myelin."
                },
                {
                    question: "Which cells form the blood-brain barrier in contact with endothelial cells?",
                    choices: ["Astrocyte end-feet", "Microglia processes", "Oligodendrocyte somas", "Ependymal tight junctions"],
                    answer: "Astrocyte end-feet",
                    category: "Neurobiology",
                    explanation: "Astrocyte end-feet surround endothelial cells of CNS capillaries and contribute to the integrity of the blood-brain barrier."
                },
                {
                    question: "Which nucleus in the thalamus relays sensory information from the body to the somatosensory cortex?",
                    choices: ["Ventral posterolateral nucleus (VPL)", "Mediodorsal nucleus", "Pulvinar", "Lateral geniculate nucleus (LGN)"],
                    answer: "Ventral posterolateral nucleus (VPL)",
                    category: "Neuroanatomy",
                    explanation: "The VPL nucleus of the thalamus receives input from the spinothalamic and medial lemniscus pathways and projects to the primary somatosensory cortex."
                },
                {
                    question: "What is the most common site of intracerebral hemorrhage in hypertension?",
                    choices: ["Putamen of the basal ganglia", "Cerebellar vermis", "Thalamus", "Subarachnoid space"],
                    answer: "Putamen of the basal ganglia",
                    category: "Neurovascular",
                    explanation: "Hypertensive hemorrhages most commonly occur in the putamen of the basal ganglia due to rupture of lenticulostriate arteries."
                },
                {
                    question: "Which pathway is primarily involved in the initiation of voluntary movement?",
                    choices: ["Corticospinal tract", "Rubrospinal tract", "Vestibulospinal tract", "Tectospinal tract"],
                    answer: "Corticospinal tract",
                    category: "Neuroanatomy",
                    explanation: "The corticospinal tract carries motor commands from the primary motor cortex to spinal motor neurons, crucial for voluntary movement control."
                }
            ]
        };

        // App State
        let currentDifficulty = 'easy';
        let currentCards = [];
        let currentIndex = 0;
        let selectedChoice = null;
        let score = { correct: 0, total: 0 };
        let categoryStats = {};
        let achievements = [];
        let studyStreak = parseInt(localStorage.getItem('studyStreak')) || 0;

        // PWA Installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').classList.add('show');
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('installBanner').classList.remove('show');
            }
        });

        document.getElementById('dismissBtn').addEventListener('click', () => {
            document.getElementById('installBanner').classList.remove('show');
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(
                'data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOw=='
            );
        }

        // Initialize App
        function initApp() {
            loadDifficulty(currentDifficulty);
            setupEventListeners();
            loadStats();
            checkAchievements();
        }

        function setupEventListeners() {
            // Difficulty selector
            document.querySelectorAll('.difficulty-btn').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.difficulty-btn').forEach((b) =>
                        b.classList.remove('active')
                    );
                    e.target.classList.add('active');
                    currentDifficulty = e.target.dataset.difficulty;
                    loadDifficulty(currentDifficulty);
                });
            });

            // Control buttons
            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('nextBtn').addEventListener('click', nextCard);
            document.getElementById('hintBtn').addEventListener('click', showHint);
            document.getElementById('statsBtn').addEventListener('click', showStats);
            document.getElementById('restartBtn').addEventListener('click', restartQuiz);
            document.getElementById('closeModal').addEventListener('click', hideStats);

            // Modal close on background click
            document.getElementById('statsModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('statsModal')) {
                    hideStats();
                }
            });
        }

        function loadDifficulty(difficulty) {
            if (difficulty === 'mixed') {
                currentCards = [
                    ...flashcardsDatabase.easy,
                    ...flashcardsDatabase.medium,
                    ...flashcardsDatabase.hard
                ];
            } else {
                currentCards = [...flashcardsDatabase[difficulty]];
            }

            shuffleArray(currentCards);
            currentIndex = 0;
            score = { correct: 0, total: 0 };
            categoryStats = {};
            loadCard();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadCard() {
            if (currentIndex >= currentCards.length) {
                showFinalStats();
                return;
            }

            const card = currentCards[currentIndex];
            selectedChoice = null;

            // Update UI
            document.getElementById('categoryBadge').textContent = card.category;
            document.getElementById('questionText').textContent = card.question;
            document.getElementById(
                'cardCounter'
            ).textContent = `Card ${currentIndex + 1}/${currentCards.length}`;
            document.getElementById(
                'scoreDisplay'
            ).textContent = `Score: ${score.correct}/${score.total}`;

            // Update progress bar
            const progress = (currentIndex / currentCards.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;

            // Load choices
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';

            const shuffledChoices = [...card.choices];
            shuffleArray(shuffledChoices);

            shuffledChoices.forEach((choice) => {
                const choiceElement = document.createElement('div');
                choiceElement.className = 'choice';
                choiceElement.textContent = choice;
                choiceElement.addEventListener('click', () =>
                    selectChoice(choiceElement, choice)
                );
                choicesContainer.appendChild(choiceElement);
            });

            // Reset buttons and feedback
            document.getElementById('checkBtn').disabled = false;
            document.getElementById('nextBtn').disabled = true;
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'none';
            feedback.className = 'feedback';
        }

        function selectChoice(element, choice) {
            // Remove previous selection
            document.querySelectorAll('.choice').forEach((c) =>
                c.classList.remove('selected')
            );

            // Select new choice
            element.classList.add('selected');
            selectedChoice = choice;
        }

        function checkAnswer() {
            if (!selectedChoice) {
                alert('Please select an answer!');
                return;
            }

            const card = currentCards[currentIndex];
            const isCorrect = selectedChoice === card.answer;

            // Update score
            score.total++;
            if (isCorrect) score.correct++;

            // Update category stats
            if (!categoryStats[card.category]) {
                categoryStats[card.category] = { correct: 0, total: 0 };
            }
            categoryStats[card.category].total++;
            if (isCorrect) categoryStats[card.category].correct++;

            // Visual feedback
            document.querySelectorAll('.choice').forEach((choiceEl) => {
                if (choiceEl.textContent === card.answer) {
                    choiceEl.classList.add('correct');
                } else if (
                    choiceEl.textContent === selectedChoice &&
                    !isCorrect
                ) {
                    choiceEl.classList.add('incorrect');
                }
            });

            // Show explanation
            const feedback = document.getElementById('feedback');
            feedback.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 10px;">
                    ${isCorrect ? '✅ Correct!' : '❌ Incorrect'}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Correct answer:</strong> ${card.answer}
                </div>
                <div>
                    <strong>Explanation:</strong> ${card.explanation}
                </div>
            `;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';

            // Update buttons
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;

            // Save stats
            saveStats();
            checkAchievements();
        }

        function nextCard() {
            currentIndex++;
            loadCard();
        }

        function showHint() {
            const card = currentCards[currentIndex];
            const hints = {
                "Neuroanatomy": "Recall the major brain structures and their functions.",
                "Neurobiology": "Think about cell types or neurotransmitters involved.",
                "Neurophysiology": "Consider pathways and synaptic mechanisms.",
                "Neurochemistry": "Focus on inhibitory vs. excitatory neurotransmitters.",
                "Cranial Nerves": "Remember the numbering and primary functions.",
                "Neurovascular": "Consider arterial supply regions in the brain.",
                "Neuroimmunology": "Think about which immune cells can cross the blood–brain barrier.",
                "Neuropathology": "Recall typical pathological findings in common diseases."
            };

            alert(
                `💡 Hint: ${
                    hints[card.category] ||
                    'Read the question carefully and eliminate unlikely answers.'
                }`
            );
        }

        function showStats() {
            const modal = document.getElementById('statsModal');
            const statsGrid = document.getElementById('statsGrid');

            // Calculate overall stats
            const totalQuestions = score.total;
            const correctAnswers = score.correct;
            const accuracy =
                totalQuestions > 0
                    ? Math.round((correctAnswers / totalQuestions) * 100)
                    : 0;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalQuestions}</div>
                    <div>Questions Answered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${correctAnswers}</div>
                    <div>Correct Answers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${accuracy}%</div>
                    <div>Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${studyStreak}</div>
                    <div>Study Streak</div>
                </div>
            `;

            // Show category breakdown
            let categoryBreakdown = '<h3>📊 By Category:</h3>';
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const categoryAccuracy = Math.round(
                    (stats.correct / stats.total) * 100
                );
                categoryBreakdown += `
                    <div style="margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <strong>${category}:</strong> ${
                    stats.correct
                }/${stats.total} (${categoryAccuracy}%)
                        <div style="width: 100%; height: 8px; background: #ddd; border-radius: 4px; margin-top: 5px;">
                            <div style="width: ${categoryAccuracy}%; height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71); border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('weakAreas').innerHTML = categoryBreakdown;

            // Show achievements
            updateAchievements();

            modal.style.display = 'flex';
        }

        function hideStats() {
            document.getElementById('statsModal').style.display = 'none';
        }

        function checkAchievements() {
            const newAchievements = [];

            // First correct answer
            if (score.correct >= 1 && !achievements.includes('first_correct')) {
                newAchievements.push('first_correct');
                achievements.push('first_correct');
            }

            // Perfect score on 5 questions
            if (
                score.total >= 5 &&
                score.correct === score.total &&
                !achievements.includes('perfect_5')
            ) {
                newAchievements.push('perfect_5');
                achievements.push('perfect_5');
            }

            // 10 questions answered
            if (score.total >= 10 && !achievements.includes('veteran')) {
                newAchievements.push('veteran');
                achievements.push('veteran');
            }

            // 80% accuracy with 10+ questions
            if (
                score.total >= 10 &&
                score.correct / score.total >= 0.8 &&
                !achievements.includes('expert')
            ) {
                newAchievements.push('expert');
                achievements.push('expert');
            }

            // Study streak
            if (studyStreak >= 3 && !achievements.includes('consistent')) {
                newAchievements.push('consistent');
                achievements.push('consistent');
            }

            // Show new achievements
            if (newAchievements.length > 0) {
                setTimeout(() => {
                    newAchievements.forEach((achievement) => {
                        showAchievementNotification(achievement);
                    });
                }, 1000);
            }

            saveStats();
        }

        function showAchievementNotification(achievementId) {
            const achievementNames = {
                first_correct: '🎯 First Correct Answer!',
                perfect_5: '🏆 Perfect 5!',
                veteran: '📚 Veteran – 10 Questions!',
                expert: '🧠 Expert – 80% Accuracy!',
                consistent: '🔥 Consistent Learner!'
            };

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #f39c12, #e67e22);
                color: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                text-align: center;
                font-size: 1.2rem;
                font-weight: bold;
                animation: achievementPop 3s ease-out forwards;
            `;

            notification.innerHTML = `
                <div>🏆 ACHIEVEMENT UNLOCKED!</div>
                <div style="margin-top: 10px;">${achievementNames[achievementId]}</div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        function updateAchievements() {
            const achievementsContainer = document.getElementById('achievements');
            const achievementNames = {
                first_correct: '🎯 First Correct',
                perfect_5: '🏆 Perfect 5',
                veteran: '📚 Veteran',
                expert: '🧠 Expert',
                consistent: '🔥 Consistent'
            };

            achievementsContainer.innerHTML = achievements
                .map(
                    (achievement) =>
                        `<div class="achievement">${achievementNames[achievement]}</div>`
                )
                .join('');
        }

        function restartQuiz() {
            if (confirm('Are you sure you want to restart the quiz?')) {
                loadDifficulty(currentDifficulty);
            }
        }

        function showFinalStats() {
            const accuracy = Math.round((score.correct / score.total) * 100);
            let message = `🎉 Quiz Completed!\n\n`;
            message += `Score: ${score.correct}/${score.total} (${accuracy}%)\n\n`;

            if (accuracy >= 90) {
                message += `🏆 Excellent! You mastered the content!`;
            } else if (accuracy >= 70) {
                message += `👍 Good job! Keep practicing!`;
            } else {
                message += `📚 Keep practicing to improve!`;
            }

            alert(message);

            // Update study streak
            studyStreak++;
            saveStats();
            checkAchievements();

            // Auto restart
            setTimeout(() => {
                if (confirm('Do you want to take another quiz?')) {
                    loadDifficulty(currentDifficulty);
                }
            }, 2000);
        }

        function saveStats() {
            localStorage.setItem('categoryStats', JSON.stringify(categoryStats));
            localStorage.setItem('achievements', JSON.stringify(achievements));
            localStorage.setItem('studyStreak', studyStreak.toString());
            localStorage.setItem('lastStudyDate', new Date().toDateString());
        }

        function loadStats() {
            const savedCategoryStats = localStorage.getItem('categoryStats');
            const savedAchievements = localStorage.getItem('achievements');
            const lastStudyDate = localStorage.getItem('lastStudyDate');

            if (savedCategoryStats) {
                categoryStats = JSON.parse(savedCategoryStats);
            }

            if (savedAchievements) {
                achievements = JSON.parse(savedAchievements);
            }

            // Reset streak if not studied today
            const today = new Date().toDateString();
            if (lastStudyDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (lastStudyDate !== yesterday.toDateString()) {
                    studyStreak = 0;
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '4') {
                const choices = document.querySelectorAll('.choice');
                const index = parseInt(e.key) - 1;
                if (choices[index] && !document.getElementById('checkBtn').disabled) {
                    selectChoice(choices[index], choices[index].textContent);
                }
            } else if (e.key === 'Enter') {
                if (!document.getElementById('checkBtn').disabled) {
                    checkAnswer();
                } else if (!document.getElementById('nextBtn').disabled) {
                    nextCard();
                }
            } else if (e.key === 'h' || e.key === 'H') {
                showHint();
            }
        });

        // Touch gestures for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const swipeDistance = touchEndX - touchStartX;

            if (Math.abs(swipeDistance) > swipeThreshold) {
                if (swipeDistance > 0 && currentIndex > 0) {
                    // Swipe right - previous card (if implemented)
                } else if (
                    swipeDistance < 0 &&
                    !document.getElementById('nextBtn').disabled
                ) {
                    // Swipe left - next card
                    nextCard();
                }
            }
        }

        // Add CSS animation for achievements
        const style = document.createElement('style');
        style.textContent = `
            @keyframes achievementPop {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                15% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                30% { transform: translate(-50%, -50%) scale(1); }
                85% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);

        // Handle online/offline status
        window.addEventListener('online', () => {
            document.body.style.opacity = '1';
        });

        window.addEventListener('offline', () => {
            document.body.style.opacity = '0.8';
            alert('📱 You are offline, but the app still works!');
        });
    </script>
</body>
</html>
